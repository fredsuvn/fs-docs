<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>space.sunqian.fs.app.di (fs-all API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: space.sunqian.fs.app.di">
<meta name="generator" content="javadoc/PackageWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="package-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li class="nav-bar-cell1-rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html#package">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Package:&nbsp;</li>
<li><a href="#package-description">Description</a>&nbsp;|&nbsp;</li>
<li><a href="#related-package-summary">Related Packages</a>&nbsp;|&nbsp;</li>
<li><a href="#class-summary">Classes and Interfaces</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<div class="header">
<h1 title="Package space.sunqian.fs.app.di" class="title">Package space.sunqian.fs.app.di</h1>
</div>
<hr>
<div class="package-signature">package <span class="element-name">space.sunqian.fs.app.di</span></div>
<section class="package-description" id="package-description">
<div class="block">A simple dependency injection framework to implement <a href="../SimpleApp.html" title="interface in space.sunqian.fs.app"><code>SimpleApp</code></a>.
 <p>
 Here is a simple example:
 <pre><code>
 public class DIExample implements PrintTest {

     public static void main(String[] args) {
         InjectedApp app = InjectedApp.newBuilder()
             .resourceTypes(
                 XController.class,
                 XServiceImpl.class,
                 XServiceProxy.class,
                 BeforeDestroyService.class
             )
             .resourceAnnotation(XResource.class)
             .postConstructAnnotation(XPostConstruct.class)
             .preDestroyAnnotation(XPreDestroy.class)
             .build();
         XService xService = app.getResource(XService.class);
         System.out.println(xService.doService());
         app.shutdown();
     }

     public static class XController {

         @XResource
         private XService xService;
         @XResource
         private ConstructService constructService;
         @XResource
         private DestroyService destroyService;

         @XPostConstruct
         public void init() {
             constructService.doConstruct();
         }

         @XPreDestroy
         public void destroy(BeforeDestroyService beforeDestroyService) {
             beforeDestroyService.doBeforeDestroyService();
             destroyService.doDestroy();
         }
     }

     public static class BeforeDestroyService {

         @XPreDestroy
         public void destroy() {
             System.out.println("before destroy");
         }
     }

     public interface XService {

         String doService();
     }

     public static class XServiceImpl implements XService {

         @Override
         public String doService() {
             return "do service...";
         }
     }

     public static class XServiceProxy implements InjectedAspect {

         @Override
         public boolean needsAspect(@Nonnull Type type) {
             return type.equals(XServiceImpl.class);
         }

         @Override
         public boolean needsAspect(@Nonnull Method method) {
             return method.getName().equals("doService");
         }

         @Override
         public void beforeInvoking(@Nonnull Method method, Object @Nonnull [] args, @Nonnull Object target) throws Throwable {
         }

         @Override
         public @Nullable Object afterReturning(@Nullable Object result, @Nonnull Method method, Object @Nonnull [] args, @Nonnull Object target) throws Throwable {
             return result + "[proxied]";
         }

         @Override
         public @Nullable Object afterThrowing(@Nonnull Throwable ex, @Nonnull Method method, Object @Nonnull [] args, @Nonnull Object target) {
             return null;
         }
     }

     public static class ConstructService {

         public void doConstruct() {
             System.out.println("construct");
         }
     }

     public static class DestroyService {

         public void doDestroy() {
             System.out.println("destroy");
         }
     }

     @Target(FIELD)
     @Retention(RUNTIME)
     public @interface XResource {
     }

     @Target(METHOD)
     @Retention(RUNTIME)
     public @interface XPostConstruct {
     }

     @Target(METHOD)
     @Retention(RUNTIME)
     public @interface XPreDestroy {
     }
 }
 </code></pre>
 The example will output:
 <pre><code>
 construct
 do service...[proxied]
 before destroy
 do before destroy
 destroy
 </code></pre>
 <p>
 In the example above, <code>resourceAnnotation</code>, <code>postConstructAnnotation</code> and <code>preDestroyAnnotation</code>
 methods specify the annotation classes used to mark resources, post-construct methods and pre-destroy methods. If not
 specified, the default is are <code>javax.annotation.Resource</code>/<code>jakarta.annotation.Resource</code>,
 <code>javax.annotation.PostConstruct</code>/<code>jakarta.annotation.PostConstruct</code> and
 <code>javax.annotation.PreDestroy</code>/<code>jakarta.annotation.PreDestroy</code>. <code>resourceTypes</code> method specifies the
 root resource types.
 <p>
 After configuration is complete, the <code>build</code> method executes the following process:
 <ol>
   <li>
       Scan all resource types starting from the specified root type. The fields annotated as resources, and the
       parameter types of the methods annotated as post-construct methods and pre-destroy methods, will also be
       considered as resources.
   </li>
   <li>
       Instantiate each type using its no-argument constructor to create resource instances in singleton mode.
   </li>
   <li>
       Inject resource instances into their corresponding fields.
   </li>
   <li>
       After injection completes, identify all resource instances that implement the
   <a href="InjectedAspect.html" title="interface in space.sunqian.fs.app.di"><code>InjectedAspect</code></a> interface s AOP handlers.
   </li>
   <li>
       Pass the remaining resource instances to each AOP handler sequentially to determine if they need to
       generate aspect instances. If any handler matches, it will generate the aspect instance and the resource
       instance will not be passed to subsequent handlers. The newly generated aspect instance replaces the
       original resource instance.
   </li>
   <li>
       Re-execute the injection process to inject the aspect instances (which replaced the original resource
       instances) into the corresponding fields.
       </li>
   <li>
       Execute post-construct methods in dependency order (if any). The dependencies of each post-construct method are
       determined by its parameter types, each parameter type is considered as a dependency. And when a post-construct
       method is executed, all its dependency resource objects will be injected into it. Note if any post-construct
       method execution fails, an exception will be thrown and all executed methods are not rolled back.
   </li>
 </ol>
 <p>
 An app can be inherited from a parent app:
 <pre><code>
 InjectedApp child = InjectedApp.newBuilder()
     .parentApps(app)
     .resourceTypes(
         SomeObject.class,
         XServiceImpl.class
     )
     .build();
 </code></pre>
 The <code>child</code> inherits all resources from its parent <code>app</code>. This simple DI framework supports singleton
 mode for resources, so resources of the same types will be reused from the parent <code>app</code>, that is to say,
 the resource of <code>XServiceImpl.class</code> in <code>child</code> will directly use its parent's instead of creating a new
 one.
 <p>
 When <code>shutdown</code> method is executed, all <code>pre-destroy</code> methods in its app's resources are executed
 sequentially according to their dependency relationships. The dependencies of each pre-destroy method are determined
 by its parameter types, each parameter type is considered as a dependency. And when a pre-destroy method is executed,
 all its dependency resource objects will be injected into it. If an exception occurs during the execution, an
 exception will be thrown and the shutdown process will terminate immediately, and the remaining <code>pre-destroy</code>
 methods will not be executed.
 <p>
 Once an app is shut down, it becomes invalid and cannot be restarted. However, its child-apps are not
 automatically shut down along with it. Child-apps that depend on resources from this app will generally continue to
 function normally, as long as those resources haven't been destroyed (by <code>pre-destroy</code> methods) during this
 shutdown process.</div>
</section>
<section class="summary">
<ul class="summary-list">
<li>
<div id="related-package-summary">
<div class="caption"><span>Related Packages</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Package</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><a href="../package-summary.html">space.sunqian.fs.app</a></div>
<div class="col-last even-row-color">
<div class="block">This package provides core application and resource interfaces, which are used to abstract application behaviors.</div>
</div>
</div>
</div>
</li>
<li>
<div id="class-summary">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="class-summary-tab0" role="tab" aria-selected="true" aria-controls="class-summary.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary', 2)" class="active-table-tab">All Classes and Interfaces</button><button id="class-summary-tab1" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab1', 2)" class="table-tab">Interfaces</button><button id="class-summary-tab2" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab2', 2)" class="table-tab">Classes</button><button id="class-summary-tab5" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab5', 2)" class="table-tab">Exceptions</button></div>
<div id="class-summary.tabpanel" role="tabpanel" aria-labelledby="class-summary-tab0">
<div class="summary-table two-column-summary">
<div class="table-header col-first">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color class-summary class-summary-tab1"><a href="InjectedApp.html" title="interface in space.sunqian.fs.app.di">InjectedApp</a></div>
<div class="col-last even-row-color class-summary class-summary-tab1">
<div class="block">A dependency injection-based sub-interface of <a href="../SimpleApp.html" title="interface in space.sunqian.fs.app"><code>SimpleApp</code></a>, built via <a href="InjectedApp.html#newBuilder()"><code>InjectedApp.newBuilder()</code></a>.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab2"><a href="InjectedApp.Builder.html" title="class in space.sunqian.fs.app.di">InjectedApp.Builder</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab2">
<div class="block">Builder for <a href="InjectedApp.html" title="interface in space.sunqian.fs.app.di"><code>InjectedApp</code></a>.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab5"><a href="InjectedAppException.html" title="class in space.sunqian.fs.app.di">InjectedAppException</a></div>
<div class="col-last even-row-color class-summary class-summary-tab5">
<div class="block">Exception for <a href="InjectedApp.html" title="interface in space.sunqian.fs.app.di"><code>InjectedApp</code></a>.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab1"><a href="InjectedAspect.html" title="interface in space.sunqian.fs.app.di">InjectedAspect</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab1">
<div class="block">The aspect-oriented programming interface for <a href="InjectedApp.html" title="interface in space.sunqian.fs.app.di"><code>InjectedApp</code></a>, extends <a href="../../dynamic/aspect/AspectHandler.html" title="interface in space.sunqian.fs.dynamic.aspect"><code>AspectHandler</code></a>.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab1"><a href="InjectedResource.html" title="interface in space.sunqian.fs.app.di">InjectedResource</a></div>
<div class="col-last even-row-color class-summary class-summary-tab1">
<div class="block">Represents resource of <a href="InjectedApp.html" title="interface in space.sunqian.fs.app.di"><code>InjectedApp</code></a>, consisting of a type and a singleton instance of that type.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab1"><a href="InjectedResource.Descriptor.html" title="interface in space.sunqian.fs.app.di">InjectedResource.Descriptor</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab1">
<div class="block">Represents descriptor of resource type.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab1"><a href="InjectedResource.FieldSetter.html" title="interface in space.sunqian.fs.app.di">InjectedResource.FieldSetter</a></div>
<div class="col-last even-row-color class-summary class-summary-tab1">
<div class="block">Represents setter for dependency field.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab1"><a href="InjectedResource.Resolver.html" title="interface in space.sunqian.fs.app.di">InjectedResource.Resolver</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab1">
<div class="block">Represents resolver for <a href="InjectedResource.html" title="interface in space.sunqian.fs.app.di"><code>InjectedResource</code></a>.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab5"><a href="InjectedResourceDestructionException.html" title="class in space.sunqian.fs.app.di">InjectedResourceDestructionException</a></div>
<div class="col-last even-row-color class-summary class-summary-tab5">
<div class="block">Exception for failing to destroy resources during <a href="InjectedApp.html" title="interface in space.sunqian.fs.app.di"><code>InjectedApp</code></a> shutdown.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab5"><a href="InjectedResourceInitializationException.html" title="class in space.sunqian.fs.app.di">InjectedResourceInitializationException</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab5">
<div class="block">Exception for failing to initialize resources during <a href="InjectedApp.html" title="interface in space.sunqian.fs.app.di"><code>InjectedApp</code></a> startup.</div>
</div>
</div>
</div>
</div>
</li>
</ul>
</section>
</main>
</div>
</div>
</body>
</html>
