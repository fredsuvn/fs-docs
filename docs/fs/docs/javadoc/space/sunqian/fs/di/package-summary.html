<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>space.sunqian.fs.di (fs-all API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: space.sunqian.fs.di">
<meta name="generator" content="javadoc/PackageWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="package-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li class="nav-bar-cell1-rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html#package">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Package:&nbsp;</li>
<li><a href="#package-description">Description</a>&nbsp;|&nbsp;</li>
<li><a href="#related-package-summary">Related Packages</a>&nbsp;|&nbsp;</li>
<li><a href="#class-summary">Classes and Interfaces</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<div class="header">
<h1 title="Package space.sunqian.fs.di" class="title">Package space.sunqian.fs.di</h1>
</div>
<hr>
<div class="package-signature">package <span class="element-name">space.sunqian.fs.di</span></div>
<section class="package-description" id="package-description">
<div class="block">This package is a simple dependency injection framework.
 <p>
 Here is a simple example:
 <pre><code>
 public class DISample {

     public static void main(String[] args) {
         DIContainer diContainer = DIContainer.newBuilder()
             .componentTypes(
                 XController.class,
                 XServiceImpl.class,
                 XServiceProxy.class,
                 BeforeDestroyService.class
             )
             .componentAnnotation(XResource.class)
             .postConstructAnnotation(XPostConstruct.class)
             .preDestroyAnnotation(XPreDestroy.class)
             .build()
             .initialize();
         XService xService = diContainer.getObject(XService.class);
         System.out.println(xService.doService());
         DIContainer child = DIContainer.newBuilder()
             .parentContainers(diContainer)
             .componentTypes(
                 XController.class,
                 XServiceImpl.class,
                 XServiceProxy.class,
                 BeforeDestroyService.class
             )
             .componentAnnotation(XResource.class)
             .postConstructAnnotation(XPostConstruct.class)
             .preDestroyAnnotation(XPreDestroy.class)
             .build()
             .initialize();
         diContainer.shutdown();
         child.shutdown();
     }

     public static class XController {

         @XResource
         private XService xService;
         @XResource
         private ConstructService constructService;
         @XResource
         private DestroyService destroyService;

         @XPostConstruct
         public void init() {
             constructService.doConstruct();
         }

         @XPreDestroy
         public void destroy(BeforeDestroyService beforeDestroyService) {
             beforeDestroyService.doBeforeDestroyService();
             destroyService.doDestroy();
         }
     }

     public static class BeforeDestroyService {

         public void doBeforeDestroyService() {
             System.out.println("do before destroy");
         }

         @XPreDestroy
         public void destroy() {
             System.out.println("before destroy");
         }
     }

     public interface XService {

         String doService();
     }

     public static class XServiceImpl implements XService {

         @Override
         public String doService() {
             return "do service...";
         }
     }

     public static class XServiceProxy implements DIAspectHandler {

         @Override
         public boolean needsAspect(@Nonnull Type type) {
             return type.equals(XServiceImpl.class);
         }

         @Override
         public boolean needsAspect(@Nonnull Method method) {
             return method.getName().equals("doService");
         }

         @Override
         public void beforeInvoking(@Nonnull Method method, Object @Nonnull [] args, @Nonnull Object target) throws Throwable {
         }

         @Override
         public @Nullable Object afterReturning(@Nullable Object result, @Nonnull Method method, Object @Nonnull [] args, @Nonnull Object target) throws Throwable {
             return result + "[proxied]";
         }

         @Override
         public @Nullable Object afterThrowing(@Nonnull Throwable ex, @Nonnull Method method, Object @Nonnull [] args, @Nonnull Object target) {
             return null;
         }
     }

     public static class ConstructService {

         public void doConstruct() {
             System.out.println("construct");
         }
     }

     public static class DestroyService {

         public void doDestroy() {
             System.out.println("destroy");
         }
     }

     @Target(FIELD)
     @Retention(RUNTIME)
     public @interface XResource {
     }

     @Target(METHOD)
     @Retention(RUNTIME)
     public @interface XPostConstruct {
     }

     @Target(METHOD)
     @Retention(RUNTIME)
     public @interface XPreDestroy {
     }
 }
 </code></pre>
 The example will output:
 <pre><code>
 construct
 do service...[proxied]
 before destroy
 do before destroy
 destroy
 </code></pre>
 <p>
 In the example above, a DI container called <code>diContainer</code> is created.
 <p>
 <code>componentAnnotation</code>, <code>postConstructAnnotation</code> and <code>preDestroyAnnotation</code> methods specify the
 annotation classes used to mark components, post-construct methods and pre-destroy methods. If not specified, the
 default are <code>javax.annotation.Resource</code>/<code>jakarta.annotation.Resource</code>,
 <code>javax.annotation.PostConstruct</code>/<code>jakarta.annotation.PostConstruct</code> and
 <code>javax.annotation.PreDestroy</code>/<code>jakarta.annotation.PreDestroy</code>. <code>componentTypes</code> method specifies
 the root component types.
 <p>
 After configuration is complete, the <code>build</code> method returns a new <a href="DIContainer.html" title="interface in space.sunqian.fs.di"><code>DIContainer</code></a>
 instance to assign to the <code>diContainer</code> variable. The <code>build</code> method executes the following process:
 <ol>
   <li>
       Scan all component types starting from the specified root type. The types' fields annotated as components, and
       the parameter types of the methods annotated as post-construct methods and pre-destroy methods, will also be
       considered as components.
   </li>
   <li>
       Instantiate each component type using its no-argument constructor to create component instances in singleton
       mode.
   </li>
   <li>
       Inject component instances into their corresponding fields.
   </li>
   <li>
       After injection completes, find out all component instances that implement the
       <a href="DIAspectHandler.html" title="interface in space.sunqian.fs.di"><code>DIAspectHandler</code></a> interface as AOP handlers.
   </li>
   <li>
       Pass the remaining component instances to each AOP handler sequentially to determine if they need to
       generate aspect instances. If any handler matches, it will generate the aspect instance and the component
       instance will not be passed to subsequent handlers. Then the newly generated aspect instances replace the
       corresponding original component instances.
   </li>
   <li>
       Re-execute the injection process to inject the aspect instances (which replaced the corresponding original
       component instances) into the corresponding fields.
   </li>
 </ol>
 Note the <code>build</code> method only instantiates and injects component instances, and does not initialize them
 (post-construct methods are not executed). Call <a href="DIContainer.html#initialize()"><code>DIContainer.initialize()</code></a> to initialize
 the components.
 <p>
 When <code>initialize</code> method is executed, all <code>post-construct</code> methods in the container will be executed
 sequentially according to their dependency relationships. The dependencies of each post-construct method are
 declared by its parameter types, each parameter is considered as a dependency (like Field in component Class). And
 when a post-construct method is executed, all its dependency parameter instances will be injected into it.
 <p>
 An DI container can be inherited from a parent container:
 <pre><code>
 DIContainer child = DIContainer.newBuilder()
     .parentContainers(diContainer)
     .componentTypes(
         SomeObject.class,
         XServiceImpl.class
     )
     .build();
 </code></pre>
 The <code>child</code> inherits all components from <code>diContainer</code>. This simple DI framework only supports singleton
 mode for components, so components of the same types will be reused from the <code>diContainer</code>. That is to say, the
 instance of <code>XServiceImpl.class</code> in <code>child</code> is the same instance as in <code>diContainer</code>.
 <p>
 To destroy an DI container, call its <code>shutdown</code> method. When <code>shutdown</code> method is executed, all
 <code>pre-destroy</code> methods in the container will be executed sequentially according to their dependency
 relationships. The dependencies of each pre-destroy method are declared by its parameter types, each parameter is
 considered as a dependency (like Field in component Class). And when a pre-destroy method is executed,
 all its dependency parameter instances will be injected into it.
 <p>
 Once a DI container is shutdown, it becomes invalid and cannot be restarted. However, its child containers are not
 automatically shutdown along with it. For a DI container, the components inherited from the parent containers will be
 destroyed with the shutdown of the parent containers, but its own components can still be used.
 <p>
 Core interface of this package:
 <ul>
     <li><a href="DIContainer.html" title="interface in space.sunqian.fs.di"><code>DIContainer</code></a></li>
     <li><a href="DIComponent.html" title="interface in space.sunqian.fs.di"><code>DIComponent</code></a></li>
     <li><a href="DIAspectHandler.html" title="interface in space.sunqian.fs.di"><code>DIAspectHandler</code></a></li>
 </ul>
 Utilities of this package:
 <ul>
     <li><a href="DIKit.html" title="class in space.sunqian.fs.di"><code>DIKit</code></a></li>
 </ul></div>
</section>
<section class="summary">
<ul class="summary-list">
<li>
<div id="related-package-summary">
<div class="caption"><span>Related Packages</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Package</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><a href="../package-summary.html">space.sunqian.fs</a></div>
<div class="col-last even-row-color">
<div class="block">The root package of fs, provides root supports for fs:</div>
</div>
</div>
</div>
</li>
<li>
<div id="class-summary">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="class-summary-tab0" role="tab" aria-selected="true" aria-controls="class-summary.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary', 2)" class="active-table-tab">All Classes and Interfaces</button><button id="class-summary-tab1" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab1', 2)" class="table-tab">Interfaces</button><button id="class-summary-tab2" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab2', 2)" class="table-tab">Classes</button><button id="class-summary-tab5" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab5', 2)" class="table-tab">Exceptions</button></div>
<div id="class-summary.tabpanel" role="tabpanel" aria-labelledby="class-summary-tab0">
<div class="summary-table two-column-summary">
<div class="table-header col-first">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color class-summary class-summary-tab1"><a href="DIAspectHandler.html" title="interface in space.sunqian.fs.di">DIAspectHandler</a></div>
<div class="col-last even-row-color class-summary class-summary-tab1">
<div class="block">The aspect-oriented programming interface for <a href="DIContainer.html" title="interface in space.sunqian.fs.di"><code>DIContainer</code></a>, extends <a href="../dynamic/aop/AspectHandler.html" title="interface in space.sunqian.fs.dynamic.aop"><code>AspectHandler</code></a>.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab1"><a href="DIComponent.html" title="interface in space.sunqian.fs.di">DIComponent</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab1">
<div class="block">Represents component of <a href="DIContainer.html" title="interface in space.sunqian.fs.di"><code>DIContainer</code></a>, consisting of a type and a singleton instance of that type.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab1"><a href="DIComponent.Descriptor.html" title="interface in space.sunqian.fs.di">DIComponent.Descriptor</a></div>
<div class="col-last even-row-color class-summary class-summary-tab1">
<div class="block">Represents descriptor of component type.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab1"><a href="DIComponent.FieldSetter.html" title="interface in space.sunqian.fs.di">DIComponent.FieldSetter</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab1">
<div class="block">Represents setter for dependency field.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab1"><a href="DIComponent.Resolver.html" title="interface in space.sunqian.fs.di">DIComponent.Resolver</a></div>
<div class="col-last even-row-color class-summary class-summary-tab1">
<div class="block">Represents resolver for <a href="DIComponent.html" title="interface in space.sunqian.fs.di"><code>DIComponent</code></a>.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab1"><a href="DIContainer.html" title="interface in space.sunqian.fs.di">DIContainer</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab1">
<div class="block">This interface represents a DI container that manages the injection of dependencies into objects.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab2"><a href="DIContainer.Builder.html" title="class in space.sunqian.fs.di">DIContainer.Builder</a></div>
<div class="col-last even-row-color class-summary class-summary-tab2">
<div class="block">Builder for <a href="DIContainer.html" title="interface in space.sunqian.fs.di"><code>DIContainer</code></a>.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab5"><a href="DIException.html" title="class in space.sunqian.fs.di">DIException</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab5">
<div class="block">Exception for dependency injection.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab5"><a href="DIInitializeException.html" title="class in space.sunqian.fs.di">DIInitializeException</a></div>
<div class="col-last even-row-color class-summary class-summary-tab5">
<div class="block">Exception for failing to initialize a DI container.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab2"><a href="DIKit.html" title="class in space.sunqian.fs.di">DIKit</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab2">
<div class="block">Dependency injection utilities.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab1"><a href="DIKit.DependenciesFunction.html" title="interface in space.sunqian.fs.di">DIKit.DependenciesFunction</a>&lt;T&gt;</div>
<div class="col-last even-row-color class-summary class-summary-tab1">
<div class="block">Represents function to get dependencies of a component.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab5"><a href="DIShutdownException.html" title="class in space.sunqian.fs.di">DIShutdownException</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab5">
<div class="block">Exception for failing to destroy a DI container.</div>
</div>
</div>
</div>
</div>
</li>
</ul>
</section>
</main>
</div>
</div>
</body>
</html>
