<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BytesKit.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fs-all</a> &gt; <a href="index.source.html" class="el_package">space.sunqian.common.base.bytes</a> &gt; <span class="el_source">BytesKit.java</span></div><h1>BytesKit.java</h1><pre class="source lang-java linenums">package space.sunqian.common.base.bytes;

import space.sunqian.annotations.Nonnull;
import space.sunqian.annotations.Nullable;

import java.nio.ByteBuffer;

/**
 * Utilities for {@code byte} and {@code byte array}.
 *
 * @author sunqian
 */
public class BytesKit {

<span class="fc" id="L15">    private static final byte @Nonnull [] EMPTY = new byte[0];</span>
<span class="fc" id="L16">    private static final @Nonnull ByteBuffer EMPTY_BUFFER = ByteBuffer.wrap(EMPTY);</span>

    /**
     * Returns whether the given buffer is null or empty.
     *
     * @param buffer the given buffer
     * @return whether the given buffer is null or empty
     */
    public static boolean isEmpty(@Nullable ByteBuffer buffer) {
<span class="fc bfc" id="L25" title="All 4 branches covered.">        return buffer == null || !buffer.hasRemaining();</span>
    }

    /**
     * Returns an empty byte array.
     *
     * @return an empty byte array
     */
    public static byte @Nonnull [] empty() {
<span class="fc" id="L34">        return EMPTY;</span>
    }

    /**
     * Returns an empty byte buffer.
     *
     * @return an empty byte buffer
     */
    public static @Nonnull ByteBuffer emptyBuffer() {
<span class="fc" id="L43">        return EMPTY_BUFFER;</span>
    }

    /**
     * Converts the given byte array to an int value in big endian, and the least significant byte is the last byte of
     * the array. Let {@code n} be {@code bytes.length - 1}, the int will be:
     * {@code byte[n-3], byte[n-2], byte[n-1], byte[n]}. If the bytes is not enough, padding 0 into the missing bytes.
     *
     * @param bytes the given byte array
     * @return the converted int value
     */
    public static int bytesToInt(byte @Nonnull [] bytes) {
<span class="fc" id="L55">        return bytesToInt(bytes, bytes.length - 1);</span>
    }

    /**
     * Converts the given byte array to an int value in big endian, and the least significant byte is specified by the
     * {@code leastIndex}. Let {@code n} be the index of the least significant byte, the int will be:
     * {@code byte[n-3], byte[n-2], byte[n-1], byte[n]}. If the bytes is not enough, padding 0 into the missing bytes.
     *
     * @param bytes      the given byte array
     * @param leastIndex the index of the least significant byte
     * @return the converted int value
     * @throws IndexOutOfBoundsException if the {@code leastIndex} is out of bounds
     */
    public static int bytesToInt(byte @Nonnull [] bytes, int leastIndex) throws IndexOutOfBoundsException {
<span class="fc" id="L69">        int ret = 0;</span>
<span class="fc" id="L70">        int off = Math.max(leastIndex - Integer.BYTES + 1, 0);</span>
<span class="fc" id="L71">        int shift = 0;</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">        for (int i = leastIndex; i &gt;= off; i--) {</span>
<span class="fc" id="L73">            int b = (bytes[i] &amp; 0xFF) &lt;&lt; shift;</span>
<span class="fc" id="L74">            ret |= b;</span>
<span class="fc" id="L75">            shift += 8;</span>
        }
<span class="fc" id="L77">        return ret;</span>
    }

    /**
     * Converts the given byte array to a long value in big endian, and the least significant byte is the last byte of
     * the array. Let {@code n} be {@code bytes.length - 1}, the long will be:
     * {@code byte[n-7], byte[n-6], byte[n-5], byte[n-4], byte[n-3], byte[n-2], byte[n-1], byte[n]}. If the bytes is not
     * enough, padding 0 into the missing bytes.
     *
     * @param bytes the given byte array
     * @return the converted long value
     */
    public static long bytesToLong(byte @Nonnull [] bytes) {
<span class="fc" id="L90">        return bytesToLong(bytes, bytes.length - 1);</span>
    }

    /**
     * Converts the given byte array to a long value in big endian, and the least significant byte is specified by the
     * {@code leastIndex}. Let {@code n} be the index of the least significant byte, the long will be:
     * {@code byte[n-7], byte[n-6], byte[n-5], byte[n-4], byte[n-3], byte[n-2], byte[n-1], byte[n]}. If the bytes is not
     * enough, padding 0 into the missing bytes.
     *
     * @param bytes      the given byte array
     * @param leastIndex the index of the least significant byte
     * @return the converted long value
     * @throws IndexOutOfBoundsException if the {@code leastIndex} is out of bounds
     */
    public static long bytesToLong(byte @Nonnull [] bytes, int leastIndex) throws IndexOutOfBoundsException {
<span class="fc" id="L105">        long ret = 0;</span>
<span class="fc" id="L106">        int off = Math.max(leastIndex - Long.BYTES + 1, 0);</span>
<span class="fc" id="L107">        int shift = 0;</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">        for (int i = leastIndex; i &gt;= off; i--) {</span>
<span class="fc" id="L109">            long b = (bytes[i] &amp; 0xFFL) &lt;&lt; shift;</span>
<span class="fc" id="L110">            ret |= b;</span>
<span class="fc" id="L111">            shift += 8;</span>
        }
<span class="fc" id="L113">        return ret;</span>
    }

    /**
     * Converts the given int value to a byte array in big endian like:
     * &lt;pre&gt;{@code
     * return new byte[]{
     *     (byte) (value &gt;&gt;&gt; 24),
     *     (byte) (value &gt;&gt;&gt; 16),
     *     (byte) (value &gt;&gt;&gt; 8),
     *     (byte) value
     * };
     * }&lt;/pre&gt;
     *
     * @param value the given int value
     * @return the converted byte array
     */
    public static byte @Nonnull [] intToBytes(int value) {
<span class="fc" id="L131">        return new byte[]{</span>
            (byte) (value &gt;&gt;&gt; 24),
            (byte) (value &gt;&gt;&gt; 16),
            (byte) (value &gt;&gt;&gt; 8),
            (byte) value
        };
    }

    /**
     * Converts the given long value to a byte array in big endian like:
     * &lt;pre&gt;{@code
     * return new byte[]{
     *     (byte) (value &gt;&gt;&gt; 56),
     *     (byte) (value &gt;&gt;&gt; 48),
     *     (byte) (value &gt;&gt;&gt; 40),
     *     (byte) (value &gt;&gt;&gt; 32),
     *     (byte) (value &gt;&gt;&gt; 24),
     *     (byte) (value &gt;&gt;&gt; 16),
     *     (byte) (value &gt;&gt;&gt; 8),
     *     (byte) value
     * };
     * }&lt;/pre&gt;
     *
     * @param value the given long value
     * @return the converted byte array
     */
    public static byte @Nonnull [] longToBytes(long value) {
<span class="fc" id="L158">        return new byte[]{</span>
            (byte) (value &gt;&gt;&gt; 56),
            (byte) (value &gt;&gt;&gt; 48),
            (byte) (value &gt;&gt;&gt; 40),
            (byte) (value &gt;&gt;&gt; 32),
            (byte) (value &gt;&gt;&gt; 24),
            (byte) (value &gt;&gt;&gt; 16),
            (byte) (value &gt;&gt;&gt; 8),
            (byte) value
        };
    }

    private BytesKit() {
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>