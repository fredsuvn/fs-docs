<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SimpleEventBus.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fs-all</a> &gt; <a href="index.source.html" class="el_package">space.sunqian.fs.eventbus</a> &gt; <span class="el_source">SimpleEventBus.java</span></div><h1>SimpleEventBus.java</h1><pre class="source lang-java linenums">package space.sunqian.fs.eventbus;

import space.sunqian.annotation.Nonnull;

import java.lang.reflect.Type;
import java.util.List;
import java.util.Map;
import java.util.concurrent.Executor;
import java.util.function.Consumer;

/**
 * This interface is a simplified event bus interface. It provides simple methods to register and unregister event
 * subscribers with the specified event type, and post methods to post events with the specified event type.
 *
 * @author sunqian
 */
public interface SimpleEventBus {

    /**
     * Creates a new event bus, all event consuming will be executed in the post thread. It is same as
     * {@link #newEventBus(Executor)} with the executor: {@code Runnable::run}.
     *
     * @return a new event bus
     */
    static @Nonnull SimpleEventBus newEventBus() {
<span class="fc" id="L26">        return newEventBus(Runnable::run);</span>
    }

    /**
     * Creates a new event bus with the specified executor.
     *
     * @param executor the executor to execute event subscribers
     * @return a new event bus
     */
    static @Nonnull SimpleEventBus newEventBus(@Nonnull Executor executor) {
<span class="fc" id="L36">        return new SimpleEventBusImpl(executor);</span>
    }

    /**
     * Registers an event subscriber for the specified event type.
     * &lt;p&gt;
     * The default implementations use copy-on-write to add subscribers, so it is recommended to use
     * {@link #register(Map)} for registering multiple event subscribers at once.
     *
     * @param type       the event type
     * @param subscriber the event subscriber
     * @param &lt;T&gt;        the event type
     */
    &lt;T&gt; void register(@Nonnull Type type, @Nonnull Consumer&lt;@Nonnull T&gt; subscriber);

    /**
     * Registers event subscribers with the specified event types, the keys of the map are the event types, and the
     * values are the event subscribers.
     *
     * @param subscribers the event subscribers
     */
    void register(@Nonnull Map&lt;@Nonnull Type, @Nonnull List&lt;@Nonnull Consumer&lt;@Nonnull ?&gt;&gt;&gt; subscribers);

    /**
     * Unregisters an event subscriber which is registered via {@code register} methods. The subscriber object is the
     * same object that is passed to {@code register} methods.
     * &lt;p&gt;
     * The default implementations use copy-on-write to remove subscribers, so it is recommended to use
     * {@link #unregister(Iterable)} for unregistering multiple event subscribers at once.
     *
     * @param subscriber the event subscriber, which is the same object that is passed to {@code register} methods
     */
    void unregister(@Nonnull Object subscriber);

    /**
     * Unregisters event subscribers which are registered via {@code register} methods. The subscriber objects are the
     * same objects that are passed to {@code register} methods.
     *
     * @param subscribers the event subscribers, which are the same objects that are passed to {@code register} methods
     */
    void unregister(@Nonnull Iterable&lt;?&gt; subscribers);

    /**
     * Posts an event. This method will call {@link #post(Object, Type)} with {@code event} and
     * {@code event.getClass()}.
     *
     * @param event the event to post
     */
    default void post(@Nonnull Object event) {
<span class="fc" id="L85">        post(event, event.getClass());</span>
<span class="fc" id="L86">    }</span>

    /**
     * Posts an event with the specified type. This method will call {@link #post(Object, Type, DispatchMode)} with
     * {@code event}, {@code eventType}, and {@link  DispatchMode#BROADCAST}.
     *
     * @param event     the event to post
     * @param eventType the event type
     */
    default void post(@Nonnull Object event, @Nonnull Type eventType) {
<span class="fc" id="L96">        post(event, eventType, DispatchMode.BROADCAST);</span>
<span class="fc" id="L97">    }</span>

    /**
     * Posts an event with the specified dispatch mode. This method will call {@link #post(Object, Type, DispatchMode)}
     * with {@code event}, {@code event.getClass()}, and {@code dispatchMode}.
     *
     * @param event        the event to post
     * @param dispatchMode the dispatch mode
     */
    default void post(@Nonnull Object event, @Nonnull DispatchMode dispatchMode) {
<span class="fc" id="L107">        post(event, event.getClass(), dispatchMode);</span>
<span class="fc" id="L108">    }</span>

    /**
     * Posts an event with the specified type and dispatch mode.
     *
     * @param event        the event to post
     * @param eventType    the event type
     * @param dispatchMode the dispatch mode
     */
    void post(@Nonnull Object event, @Nonnull Type eventType, @Nonnull DispatchMode dispatchMode);

    /**
     * The dispatch mode for posting events.
     */
<span class="fc" id="L122">    enum DispatchMode {</span>
        /**
         * The broadcast mode: subscribers which subscribe the event type will receive the event.
         * &lt;p&gt;
         * This is the default mode.
         */
<span class="fc" id="L128">        BROADCAST,</span>
        /**
         * The chain dispatch mode: subscribers which subscribe the event type will receive the event in the order they
         * are registered, and the event propagation can be prevented by any subscriber.
         * &lt;p&gt;
         * In this mode, if a subscriber throws an exception, the event propagation will be stopped.
         */
<span class="fc" id="L135">        CHAIN</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>