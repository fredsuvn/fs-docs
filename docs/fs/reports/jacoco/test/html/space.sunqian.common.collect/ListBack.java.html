<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ListBack.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fs-all</a> &gt; <a href="index.source.html" class="el_package">space.sunqian.common.collect</a> &gt; <span class="el_source">ListBack.java</span></div><h1>ListBack.java</h1><pre class="source lang-java linenums">package space.sunqian.common.collect;

import space.sunqian.annotations.Immutable;
import space.sunqian.annotations.Nonnull;

import java.io.Serializable;
import java.util.AbstractList;
import java.util.Collections;
import java.util.List;
import java.util.RandomAccess;

final class ListBack {

    static @Nonnull List&lt;Boolean&gt; asList(boolean @Nonnull [] array) {
<span class="fc" id="L15">        return new BooleanArrayList(array);</span>
    }

    static @Nonnull List&lt;Byte&gt; asList(byte @Nonnull [] array) {
<span class="fc" id="L19">        return new ByteArrayList(array);</span>
    }

    static @Nonnull List&lt;Short&gt; asList(short @Nonnull [] array) {
<span class="fc" id="L23">        return new ShortArrayList(array);</span>
    }

    static @Nonnull List&lt;Character&gt; asList(char @Nonnull [] array) {
<span class="fc" id="L27">        return new CharArrayList(array);</span>
    }

    static @Nonnull List&lt;Integer&gt; asList(int @Nonnull [] array) {
<span class="fc" id="L31">        return new IntArrayList(array);</span>
    }

    static @Nonnull List&lt;Long&gt; asList(long @Nonnull [] array) {
<span class="fc" id="L35">        return new LongArrayList(array);</span>
    }

    static @Nonnull List&lt;Float&gt; asList(float @Nonnull [] array) {
<span class="fc" id="L39">        return new FloatArrayList(array);</span>
    }

    static @Nonnull List&lt;Double&gt; asList(double @Nonnull [] array) {
<span class="fc" id="L43">        return new DoubleArrayList(array);</span>
    }

    static &lt;T&gt; @Nonnull @Immutable List&lt;T&gt; immutableList(T @Nonnull [] array) {
<span class="fc bfc" id="L47" title="All 2 branches covered.">        return ArrayKit.isEmpty(array) ? Collections.emptyList() : new ImmutableList&lt;&gt;(array);</span>
    }

    static @Nonnull @Immutable List&lt;@Nonnull Boolean&gt; immutableList(boolean @Nonnull [] array) {
<span class="fc bfc" id="L51" title="All 2 branches covered.">        return ArrayKit.isEmpty(array) ? Collections.emptyList() : new BooleanImmutableList(array);</span>
    }

    static @Nonnull @Immutable List&lt;@Nonnull Byte&gt; immutableList(byte @Nonnull [] array) {
<span class="fc bfc" id="L55" title="All 2 branches covered.">        return ArrayKit.isEmpty(array) ? Collections.emptyList() : new ByteImmutableList(array);</span>
    }

    static @Nonnull @Immutable List&lt;@Nonnull Short&gt; immutableList(short @Nonnull [] array) {
<span class="fc bfc" id="L59" title="All 2 branches covered.">        return ArrayKit.isEmpty(array) ? Collections.emptyList() : new ShortImmutableList(array);</span>
    }

    static @Nonnull @Immutable List&lt;@Nonnull Character&gt; immutableList(char @Nonnull [] array) {
<span class="fc bfc" id="L63" title="All 2 branches covered.">        return ArrayKit.isEmpty(array) ? Collections.emptyList() : new CharImmutableList(array);</span>
    }

    static @Nonnull @Immutable List&lt;@Nonnull Integer&gt; immutableList(int @Nonnull [] array) {
<span class="fc bfc" id="L67" title="All 2 branches covered.">        return ArrayKit.isEmpty(array) ? Collections.emptyList() : new IntImmutableList(array);</span>
    }

    static @Nonnull @Immutable List&lt;@Nonnull Long&gt; immutableList(long @Nonnull [] array) {
<span class="fc bfc" id="L71" title="All 2 branches covered.">        return ArrayKit.isEmpty(array) ? Collections.emptyList() : new LongImmutableList(array);</span>
    }

    static @Nonnull @Immutable List&lt;@Nonnull Float&gt; immutableList(float @Nonnull [] array) {
<span class="fc bfc" id="L75" title="All 2 branches covered.">        return ArrayKit.isEmpty(array) ? Collections.emptyList() : new FloatImmutableList(array);</span>
    }

    static @Nonnull @Immutable List&lt;@Nonnull Double&gt; immutableList(double @Nonnull [] array) {
<span class="fc bfc" id="L79" title="All 2 branches covered.">        return ArrayKit.isEmpty(array) ? Collections.emptyList() : new DoubleImmutableList(array);</span>
    }

    @SafeVarargs
    static &lt;T&gt; @Nonnull List&lt;T&gt; compositeList(@Nonnull List&lt;T&gt; @Nonnull ... lists) {
<span class="fc" id="L84">        return new CompositeList&lt;&gt;(lists);</span>
    }

    private static final class BooleanArrayList
        extends AbstractList&lt;Boolean&gt; implements RandomAccess, Serializable {

        private final boolean[] array;

<span class="fc" id="L92">        private BooleanArrayList(boolean[] array) {</span>
<span class="fc" id="L93">            this.array = array;</span>
<span class="fc" id="L94">        }</span>

        @Override
        public Boolean get(int index) {
<span class="fc" id="L98">            return array[index];</span>
        }

        @Override
        public Boolean set(int index, Boolean element) {
<span class="fc" id="L103">            Boolean old = array[index];</span>
<span class="fc" id="L104">            array[index] = element;</span>
<span class="fc" id="L105">            return old;</span>
        }

        @Override
        public int size() {
<span class="fc" id="L110">            return array.length;</span>
        }
    }

    private static final class ByteArrayList
        extends AbstractList&lt;Byte&gt; implements RandomAccess, Serializable {

        private final byte[] array;

<span class="fc" id="L119">        private ByteArrayList(byte[] array) {</span>
<span class="fc" id="L120">            this.array = array;</span>
<span class="fc" id="L121">        }</span>

        @Override
        public Byte get(int index) {
<span class="fc" id="L125">            return array[index];</span>
        }

        @Override
        public Byte set(int index, Byte element) {
<span class="fc" id="L130">            Byte old = array[index];</span>
<span class="fc" id="L131">            array[index] = element;</span>
<span class="fc" id="L132">            return old;</span>
        }

        @Override
        public int size() {
<span class="fc" id="L137">            return array.length;</span>
        }
    }

    private static final class ShortArrayList
        extends AbstractList&lt;Short&gt; implements RandomAccess, Serializable {

        private final short[] array;

<span class="fc" id="L146">        private ShortArrayList(short[] array) {</span>
<span class="fc" id="L147">            this.array = array;</span>
<span class="fc" id="L148">        }</span>

        @Override
        public Short get(int index) {
<span class="fc" id="L152">            return array[index];</span>
        }

        @Override
        public Short set(int index, Short element) {
<span class="fc" id="L157">            short old = array[index];</span>
<span class="fc" id="L158">            array[index] = element;</span>
<span class="fc" id="L159">            return old;</span>
        }

        @Override
        public int size() {
<span class="fc" id="L164">            return array.length;</span>
        }
    }

    private static final class CharArrayList
        extends AbstractList&lt;Character&gt; implements RandomAccess, Serializable {

        private final char[] array;

<span class="fc" id="L173">        private CharArrayList(char[] array) {</span>
<span class="fc" id="L174">            this.array = array;</span>
<span class="fc" id="L175">        }</span>

        @Override
        public Character get(int index) {
<span class="fc" id="L179">            return array[index];</span>
        }

        @Override
        public Character set(int index, Character element) {
<span class="fc" id="L184">            Character old = array[index];</span>
<span class="fc" id="L185">            array[index] = element;</span>
<span class="fc" id="L186">            return old;</span>
        }

        @Override
        public int size() {
<span class="fc" id="L191">            return array.length;</span>
        }
    }

    private static final class IntArrayList
        extends AbstractList&lt;Integer&gt; implements RandomAccess, Serializable {

        private final int[] array;

<span class="fc" id="L200">        private IntArrayList(int[] array) {</span>
<span class="fc" id="L201">            this.array = array;</span>
<span class="fc" id="L202">        }</span>

        @Override
        public Integer get(int index) {
<span class="fc" id="L206">            return array[index];</span>
        }

        @Override
        public Integer set(int index, Integer element) {
<span class="fc" id="L211">            Integer old = array[index];</span>
<span class="fc" id="L212">            array[index] = element;</span>
<span class="fc" id="L213">            return old;</span>
        }

        @Override
        public int size() {
<span class="fc" id="L218">            return array.length;</span>
        }
    }

    private static final class LongArrayList
        extends AbstractList&lt;Long&gt; implements RandomAccess, Serializable {

        private final long[] array;

<span class="fc" id="L227">        private LongArrayList(long[] array) {</span>
<span class="fc" id="L228">            this.array = array;</span>
<span class="fc" id="L229">        }</span>

        @Override
        public Long get(int index) {
<span class="fc" id="L233">            return array[index];</span>
        }

        @Override
        public Long set(int index, Long element) {
<span class="fc" id="L238">            Long old = array[index];</span>
<span class="fc" id="L239">            array[index] = element;</span>
<span class="fc" id="L240">            return old;</span>
        }

        @Override
        public int size() {
<span class="fc" id="L245">            return array.length;</span>
        }
    }

    private static final class FloatArrayList
        extends AbstractList&lt;Float&gt; implements RandomAccess, Serializable {

        private final float[] array;

<span class="fc" id="L254">        private FloatArrayList(float[] array) {</span>
<span class="fc" id="L255">            this.array = array;</span>
<span class="fc" id="L256">        }</span>

        @Override
        public Float get(int index) {
<span class="fc" id="L260">            return array[index];</span>
        }

        @Override
        public Float set(int index, Float element) {
<span class="fc" id="L265">            Float old = array[index];</span>
<span class="fc" id="L266">            array[index] = element;</span>
<span class="fc" id="L267">            return old;</span>
        }

        @Override
        public int size() {
<span class="fc" id="L272">            return array.length;</span>
        }
    }

    private static final class DoubleArrayList
        extends AbstractList&lt;Double&gt; implements RandomAccess, Serializable {

        private final double[] array;

<span class="fc" id="L281">        private DoubleArrayList(double[] array) {</span>
<span class="fc" id="L282">            this.array = array;</span>
<span class="fc" id="L283">        }</span>

        @Override
        public Double get(int index) {
<span class="fc" id="L287">            return array[index];</span>
        }

        @Override
        public Double set(int index, Double element) {
<span class="fc" id="L292">            Double old = array[index];</span>
<span class="fc" id="L293">            array[index] = element;</span>
<span class="fc" id="L294">            return old;</span>
        }

        @Override
        public int size() {
<span class="fc" id="L299">            return array.length;</span>
        }
    }

    @Immutable
    private static final class ImmutableList&lt;T&gt;
        extends AbstractList&lt;T&gt; implements RandomAccess, Serializable {

        private final T[] array;

<span class="fc" id="L309">        private ImmutableList(T[] array) {</span>
<span class="fc" id="L310">            this.array = array;</span>
<span class="fc" id="L311">        }</span>

        @Override
        public T get(int index) {
<span class="fc" id="L315">            return array[index];</span>
        }

        @Override
        public int size() {
<span class="fc" id="L320">            return array.length;</span>
        }
    }

    @Immutable
    private static final class BooleanImmutableList
        extends AbstractList&lt;Boolean&gt; implements RandomAccess, Serializable {

        private final boolean[] array;

<span class="fc" id="L330">        private BooleanImmutableList(boolean[] array) {</span>
<span class="fc" id="L331">            this.array = array;</span>
<span class="fc" id="L332">        }</span>

        @Override
        public Boolean get(int index) {
<span class="fc" id="L336">            return array[index];</span>
        }

        @Override
        public int size() {
<span class="fc" id="L341">            return array.length;</span>
        }
    }

    @Immutable
    private static final class ByteImmutableList
        extends AbstractList&lt;Byte&gt; implements RandomAccess, Serializable {

        private final byte[] array;

<span class="fc" id="L351">        private ByteImmutableList(byte[] array) {</span>
<span class="fc" id="L352">            this.array = array;</span>
<span class="fc" id="L353">        }</span>

        @Override
        public Byte get(int index) {
<span class="fc" id="L357">            return array[index];</span>
        }

        @Override
        public int size() {
<span class="fc" id="L362">            return array.length;</span>
        }
    }

    @Immutable
    private static final class ShortImmutableList
        extends AbstractList&lt;Short&gt; implements RandomAccess, Serializable {

        private final short[] array;

<span class="fc" id="L372">        private ShortImmutableList(short[] array) {</span>
<span class="fc" id="L373">            this.array = array;</span>
<span class="fc" id="L374">        }</span>

        @Override
        public Short get(int index) {
<span class="fc" id="L378">            return array[index];</span>
        }

        @Override
        public int size() {
<span class="fc" id="L383">            return array.length;</span>
        }
    }

    @Immutable
    private static final class CharImmutableList
        extends AbstractList&lt;Character&gt; implements RandomAccess, Serializable {

        private final char[] array;

<span class="fc" id="L393">        private CharImmutableList(char[] array) {</span>
<span class="fc" id="L394">            this.array = array;</span>
<span class="fc" id="L395">        }</span>

        @Override
        public Character get(int index) {
<span class="fc" id="L399">            return array[index];</span>
        }

        @Override
        public int size() {
<span class="fc" id="L404">            return array.length;</span>
        }
    }

    @Immutable
    private static final class IntImmutableList
        extends AbstractList&lt;Integer&gt; implements RandomAccess, Serializable {

        private final int[] array;

<span class="fc" id="L414">        private IntImmutableList(int[] array) {</span>
<span class="fc" id="L415">            this.array = array;</span>
<span class="fc" id="L416">        }</span>

        @Override
        public Integer get(int index) {
<span class="fc" id="L420">            return array[index];</span>
        }

        @Override
        public int size() {
<span class="fc" id="L425">            return array.length;</span>
        }
    }

    @Immutable
    private static final class LongImmutableList
        extends AbstractList&lt;Long&gt; implements RandomAccess, Serializable {

        private final long[] array;

<span class="fc" id="L435">        private LongImmutableList(long[] array) {</span>
<span class="fc" id="L436">            this.array = array;</span>
<span class="fc" id="L437">        }</span>

        @Override
        public Long get(int index) {
<span class="fc" id="L441">            return array[index];</span>
        }

        @Override
        public int size() {
<span class="fc" id="L446">            return array.length;</span>
        }
    }

    @Immutable
    private static final class FloatImmutableList
        extends AbstractList&lt;Float&gt; implements RandomAccess, Serializable {

        private final float[] array;

<span class="fc" id="L456">        private FloatImmutableList(float[] array) {</span>
<span class="fc" id="L457">            this.array = array;</span>
<span class="fc" id="L458">        }</span>

        @Override
        public Float get(int index) {
<span class="fc" id="L462">            return array[index];</span>
        }

        @Override
        public int size() {
<span class="fc" id="L467">            return array.length;</span>
        }
    }

    @Immutable
    private static final class DoubleImmutableList
        extends AbstractList&lt;Double&gt; implements RandomAccess, Serializable {

        private final double[] array;

<span class="fc" id="L477">        private DoubleImmutableList(double[] array) {</span>
<span class="fc" id="L478">            this.array = array;</span>
<span class="fc" id="L479">        }</span>

        @Override
        public Double get(int index) {
<span class="fc" id="L483">            return array[index];</span>
        }

        @Override
        public int size() {
<span class="fc" id="L488">            return array.length;</span>
        }
    }

    private static final class CompositeList&lt;T&gt;
        extends AbstractList&lt;T&gt; implements RandomAccess, Serializable {

        private final @Nonnull List&lt;T&gt; @Nonnull [] lists;

<span class="fc" id="L497">        private CompositeList(@Nonnull List&lt;T&gt; @Nonnull [] lists) {</span>
<span class="fc" id="L498">            this.lists = lists;</span>
<span class="fc" id="L499">        }</span>

        @Override
        public T get(int index) {
<span class="fc" id="L503">            long pos = getElementPos(index);</span>
<span class="fc" id="L504">            int listIndex = (int) (pos &gt;&gt;&gt; 32);</span>
<span class="fc" id="L505">            int elementIndex = (int) (pos &amp; 0x00000000ffffffffL);</span>
<span class="fc" id="L506">            return lists[listIndex].get(elementIndex);</span>
        }

        @Override
        public T set(int index, T element) {
<span class="fc" id="L511">            long pos = getElementPos(index);</span>
<span class="fc" id="L512">            int listIndex = (int) (pos &gt;&gt;&gt; 32);</span>
<span class="fc" id="L513">            int elementIndex = (int) (pos &amp; 0x00000000ffffffffL);</span>
<span class="fc" id="L514">            return lists[listIndex].set(elementIndex, element);</span>
        }

        private long getElementPos(final int index) {
<span class="fc" id="L518">            int x = index;</span>
<span class="fc bfc" id="L519" title="All 2 branches covered.">            for (int i = 0; i &lt; lists.length; i++) {</span>
<span class="fc" id="L520">                List&lt;T&gt; list = lists[i];</span>
<span class="fc bfc" id="L521" title="All 2 branches covered.">                if (x &lt; list.size()) {</span>
<span class="fc" id="L522">                    return ((long) i &lt;&lt; 32) | (x &amp; 0x00000000ffffffffL);</span>
                } else {
<span class="fc" id="L524">                    x -= list.size();</span>
                }
            }
<span class="fc" id="L527">            throw new IndexOutOfBoundsException(&quot;index: &quot; + index + &quot;.&quot;);</span>
        }

        @Override
        public int size() {
<span class="fc" id="L532">            int size = 0;</span>
<span class="fc bfc" id="L533" title="All 2 branches covered.">            for (List&lt;T&gt; list : lists) {</span>
<span class="fc" id="L534">                size += list.size();</span>
            }
<span class="fc" id="L536">            return size;</span>
        }
    }

    private ListBack() {
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>