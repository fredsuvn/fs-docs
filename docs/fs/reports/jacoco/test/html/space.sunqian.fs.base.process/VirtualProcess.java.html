<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VirtualProcess.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fs-all</a> &gt; <a href="index.source.html" class="el_package">space.sunqian.fs.base.process</a> &gt; <span class="el_source">VirtualProcess.java</span></div><h1>VirtualProcess.java</h1><pre class="source lang-java linenums">package space.sunqian.fs.base.process;

import space.sunqian.annotation.Nonnull;
import space.sunqian.fs.Fs;
import space.sunqian.fs.io.IOKit;

import java.io.InputStream;
import java.io.OutputStream;

/**
 * A virtual process used for simulation. There are protected fields:
 * &lt;ul&gt;
 *     &lt;li&gt;{@link #alive}: to specify whether this process is alive, initial is {@code true};&lt;/li&gt;
 *     &lt;li&gt;
 *         {@link #normal}: to specify whether this process ends normally, the {@link #exitValue()} returns {@code 0} if
 *         normally, otherwise {@code 1}; initial is {@code true};
 *     &lt;/li&gt;
 * &lt;/ul&gt;
 *
 * @author sunqian
 */
public class VirtualProcess extends Process {

    /**
     * The flag to specify whether this process is alive.
     */
<span class="fc" id="L27">    protected volatile boolean alive = true;</span>
    /**
     * The flag to specify whether this process ends normally.
     */
<span class="fc" id="L31">    protected volatile boolean normal = true;</span>

    private final @Nonnull InputStream input;
    private final @Nonnull InputStream error;
    private final @Nonnull OutputStream output;

    /**
     * Constructs a new virtual process. The result of {@link #getInputStream()} and {@link #getErrorStream()} are
     * {@link IOKit#emptyInputStream()}, and the result of {@link #getOutputStream()} is
     * {@link IOKit#nullOutputStream()}.
     */
    public VirtualProcess() {
<span class="fc" id="L43">        this(IOKit.emptyInputStream(), IOKit.nullOutputStream());</span>
<span class="fc" id="L44">    }</span>

    /**
     * Constructs with the specified input stream and output stream. These streams are the result of
     * {@link #getInputStream()} and {@link #getOutputStream()}. The {@link #getErrorStream()} will be mered into the
     * {@link #getInputStream()}.
     *
     * @param input  the specified input and error stream
     * @param output the specified output stream
     */
    public VirtualProcess(
        @Nonnull InputStream input,
        @Nonnull OutputStream output
    ) {
<span class="fc" id="L58">        this(input, input, output);</span>
<span class="fc" id="L59">    }</span>

    /**
     * Constructs with the specified input stream, error stream and output stream. These streams are the result of
     * {@link #getInputStream()}, {@link #getErrorStream()} and {@link #getOutputStream()}.
     *
     * @param input  the specified input stream
     * @param error  the specified error stream
     * @param output the specified output stream
     */
    public VirtualProcess(
        @Nonnull InputStream input,
        @Nonnull InputStream error,
        @Nonnull OutputStream output
<span class="fc" id="L73">    ) {</span>
<span class="fc" id="L74">        this.input = input;</span>
<span class="fc" id="L75">        this.error = error;</span>
<span class="fc" id="L76">        this.output = output;</span>
<span class="fc" id="L77">    }</span>

    /**
     * Sets the value of alive flag.
     *
     * @param alive the value of alive flag
     * @return this
     */
    public VirtualProcess alive(boolean alive) {
<span class="fc" id="L86">        this.alive = alive;</span>
<span class="fc" id="L87">        return this;</span>
    }

    /**
     * Sets the value of normal flag.
     *
     * @param normal the value of normal flag
     * @return this
     */
    public VirtualProcess normal(boolean normal) {
<span class="fc" id="L97">        this.normal = normal;</span>
<span class="fc" id="L98">        return this;</span>
    }

    @Override
    public boolean isAlive() {
<span class="fc" id="L103">        return alive;</span>
    }

    @Override
    public @Nonnull OutputStream getOutputStream() {
<span class="fc" id="L108">        return output;</span>
    }

    @Override
    public @Nonnull InputStream getInputStream() {
<span class="fc" id="L113">        return input;</span>
    }

    @Override
    public @Nonnull InputStream getErrorStream() {
<span class="fc" id="L118">        return error;</span>
    }

    @Override
    public int waitFor() {
<span class="fc bfc" id="L123" title="All 2 branches covered.">        Fs.until(() -&gt; !isAlive());</span>
<span class="fc" id="L124">        return exitValue();</span>
    }

    @Override
    public int exitValue() throws IllegalThreadStateException {
<span class="fc bfc" id="L129" title="All 2 branches covered.">        if (isAlive()) {</span>
<span class="fc" id="L130">            throw new IllegalThreadStateException();</span>
        }
<span class="fc bfc" id="L132" title="All 2 branches covered.">        return normal ? 0 : 1;</span>
    }

    @Override
    public void destroy() {
<span class="fc" id="L137">        alive = false;</span>
<span class="fc" id="L138">    }</span>

    @Override
    public @Nonnull Process destroyForcibly() {
<span class="fc" id="L142">        destroy();</span>
<span class="fc" id="L143">        return this;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>